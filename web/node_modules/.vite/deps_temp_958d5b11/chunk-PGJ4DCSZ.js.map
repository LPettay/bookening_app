{
  "version": 3,
  "sources": ["../../@descope/sdk-mixins/src/mixins/loggerMixin/loggerMixin.ts", "../../@descope/sdk-mixins/src/mixins/initLifecycleMixin.ts", "../../@descope/sdk-mixins/src/mixins/observeAttributesMixin/helpers.ts", "../../@descope/sdk-mixins/src/mixins/observeAttributesMixin/observeAttributesMixin.ts", "../../@descope/sdk-mixins/src/mixins/cspNonceMixin.ts", "../../@descope/sdk-mixins/src/mixins/injectStyleMixin.ts"],
  "sourcesContent": ["import { createSingletonMixin } from '@descope/sdk-helpers';\nimport { Logger } from './types';\n\nconst logLevels = ['error', 'warn', 'info', 'debug'] as const;\n\nexport type LogLevel = (typeof logLevels)[number];\n\nexport const loggerMixin = createSingletonMixin(\n  <T extends CustomElementConstructor>(superclass: T) =>\n    class LoggerMixinClass extends superclass {\n      #logger: Logger = this.#wrapLogger(console);\n\n      #wrapLogger(logger: Partial<Logger>) {\n        return logLevels.reduce((acc, logLevel) => {\n          acc[logLevel] = (...args: any[]) => {\n            this.onLogEvent(logLevel, args);\n            logger[logLevel]?.(...args);\n          };\n\n          return acc;\n        }, {}) as Logger;\n      }\n\n      set logger(logger: Partial<Logger> | undefined) {\n        this.#logger = this.#wrapLogger(logger || console);\n      }\n\n      get logger(): Logger {\n        return this.#logger;\n      }\n\n      // eslint-disable-next-line class-methods-use-this, @typescript-eslint/no-unused-vars\n      onLogEvent(logLevel: LogLevel, data: any[]) {}\n    },\n);\n", "import { createSingletonMixin } from '@descope/sdk-helpers';\n\nexport const initLifecycleMixin = createSingletonMixin(\n  <T extends CustomElementConstructor>(superclass: T) =>\n    class InitLifecycleMixinClass extends superclass {\n      #isInit = true;\n\n      connectedCallback() {\n        super.connectedCallback?.();\n\n        if (this.shadowRoot?.isConnected) {\n          // the init function is running once, on the first time the component is connected\n          if (this.#isInit) {\n            this.#isInit = false;\n            this.init();\n          }\n        }\n      }\n\n      // eslint-disable-next-line class-methods-use-this, @typescript-eslint/no-empty-function\n      async init() {}\n    },\n);\n", "export const attributesObserver = (\n  ele: HTMLElement,\n  callback: (attrName: string) => void,\n) => {\n  // sync all attrs on init\n  Array.from(ele.attributes).forEach((attr) => callback(attr.name));\n\n  const observer = new MutationObserver((mutationsList) => {\n    mutationsList.forEach((mutation) => {\n      if (mutation.type === 'attributes') {\n        callback(mutation.attributeName);\n      }\n    });\n  });\n\n  observer.observe(ele, { attributes: true });\n};\n", "import { createSingletonMixin, compose } from '@descope/sdk-helpers';\nimport { initLifecycleMixin } from '../initLifecycleMixin';\nimport { loggerMixin } from '../loggerMixin';\nimport { attributesObserver } from './helpers';\n\ntype OnAttrChange = (attrName: string, value: string | null) => void;\n\nexport const observeAttributesMixin = createSingletonMixin(\n  <T extends CustomElementConstructor>(superclass: T) => {\n    const BaseClass = compose(loggerMixin, initLifecycleMixin)(superclass);\n    return class ObserveAttributesMixinClass extends BaseClass {\n      #observeMappings = {};\n\n      async init() {\n        await super.init?.();\n\n        attributesObserver(this, (attrName: string) => {\n          this.#observeMappings[attrName]?.forEach((cb: OnAttrChange) => {\n            cb(attrName, this.getAttribute(attrName));\n          });\n        });\n      }\n\n      observeAttribute(attrName: string, onAttrChange: OnAttrChange) {\n        if (!this.#observeMappings[attrName]) {\n          this.#observeMappings[attrName] = [];\n        }\n\n        const idx = this.#observeMappings[attrName].push(onAttrChange);\n\n        return () => this.#observeMappings[attrName].splice(idx, 1);\n      }\n\n      observeAttributes(attrs: string[], cb: OnAttrChange) {\n        const unobserveList = attrs.reduce((acc, attrName) => {\n          acc.push(this.observeAttribute(attrName, cb));\n\n          return acc;\n        }, []);\n\n        return () => unobserveList.forEach((unobserve) => unobserve());\n      }\n    };\n  },\n);\n", "import { compose, createSingletonMixin } from '@descope/sdk-helpers';\nimport { initLifecycleMixin } from './initLifecycleMixin';\nimport { observeAttributesMixin } from './observeAttributesMixin';\n\nexport const cspNonceMixin = createSingletonMixin(\n  <T extends CustomElementConstructor>(superclass: T) => {\n    const BaseClass = compose(\n      initLifecycleMixin,\n      observeAttributesMixin,\n    )(superclass);\n\n    return class CspNonceMixinClass extends BaseClass {\n      get nonce(): string {\n        return this.getAttribute('nonce') || '';\n      }\n\n      #setNonce() {\n        (window as any).DESCOPE_NONCE = this.nonce;\n      }\n\n      async init() {\n        await super.init?.();\n\n        this.observeAttribute('nonce', this.#setNonce.bind(this));\n        this.#setNonce();\n      }\n    };\n  },\n);\n", "import { compose, createSingletonMixin } from '@descope/sdk-helpers';\nimport { cspNonceMixin } from './cspNonceMixin';\n\n// we should mimic the CSSStyleSheet API for the fns we are using\nclass CSSStyleSheetMock {\n  styleEle: HTMLStyleElement;\n  ref: ShadowRoot | HTMLElement | null;\n  constructor(ref: ShadowRoot, nonce: string, { prepend = false } = {}) {\n    this.styleEle = document.createElement('style');\n    this.styleEle.setAttribute('nonce', nonce);\n    this.ref = ref;\n\n    if (!this.ref) {\n      return;\n    }\n\n    if (prepend) {\n      this.ref.prepend(this.styleEle);\n    } else {\n      this.ref.append(this.styleEle);\n    }\n  }\n\n  replaceSync(cssString: string) {\n    this.styleEle.textContent = cssString;\n  }\n\n  get cssRules() {\n    return this.styleEle.sheet?.cssRules;\n  }\n}\n\nexport const injectStyleMixin = createSingletonMixin(\n  <T extends CustomElementConstructor>(superclass: T) => {\n    const BaseClass = compose(cspNonceMixin)(superclass);\n    return class InjectStyleMixinClass extends BaseClass {\n      injectStyle(cssString: string, { prepend = false } = {}) {\n        let style: CSSStyleSheet | CSSStyleSheetMock;\n        try {\n          style = new CSSStyleSheet();\n        } catch (e) {\n          // fallback for browsers that don't support CSSStyleSheet\n          style = new CSSStyleSheetMock(this.shadowRoot, this.nonce, {\n            prepend,\n          });\n        }\n\n        if (cssString) {\n          style.replaceSync(cssString);\n        }\n\n        if (style instanceof CSSStyleSheet) {\n          const ref = this.shadowRoot;\n\n          if (ref && 'adoptedStyleSheets' in ref) {\n            const adoptedStyleSheets = [...(ref.adoptedStyleSheets || [])];\n            adoptedStyleSheets[prepend ? 'unshift' : 'push'](style);\n\n            ref.adoptedStyleSheets = adoptedStyleSheets;\n          }\n        }\n\n        return style;\n      }\n    };\n  },\n);\n\nexport type InjectedStyle = CSSStyleSheet | CSSStyleSheetMock;\n"],
  "mappings": "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",
  "names": ["_b"]
}
