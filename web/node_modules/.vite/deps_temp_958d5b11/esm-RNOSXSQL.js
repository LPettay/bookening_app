import {
  cookieConfigMixin,
  createAsyncThunk,
  createSelector,
  createStateManagementMixin,
  debuggerMixin,
  s
} from "./chunk-XU36NMJB.js";
import {
  baseUrlMixin,
  createValidateAttributesMixin,
  descopeUiMixin,
  initElementMixin,
  projectIdMixin,
  staticResourcesMixin,
  themeMixin
} from "./chunk-JGGIE4AD.js";
import {
  Ie
} from "./chunk-5SHIU7TC.js";
import {
  initLifecycleMixin,
  loggerMixin,
  observeAttributesMixin
} from "./chunk-PGJ4DCSZ.js";
import {
  __awaiter,
  __classPrivateFieldGet,
  __classPrivateFieldSet,
  h,
  n,
  r
} from "./chunk-C4K4ZQL2.js";
import "./chunk-KEXKKQVW.js";

// node_modules/@descope/applications-portal-widget/dist/esm/index.js
var x;
!function(t) {
  t.oidc = "oidc", t.saml = "saml";
}(x || (x = {}));
var S = (t) => t.ssoAppsList.data;
var R = createSelector(S, (t) => {
  var e;
  return null === (e = null == t ? void 0 : t.filter) || void 0 === e ? void 0 : e.call(t, (t2) => t2.appType === x.saml);
});
var j = createSelector(S, (t) => {
  var e;
  return null === (e = null == t ? void 0 : t.filter) || void 0 === e ? void 0 : e.call(t, (t2) => {
    var e2;
    return t2.appType === x.oidc && (null === (e2 = t2.oidcSettings) || void 0 === e2 ? void 0 : e2.customIdpInitiatedLoginPageUrl);
  });
});
var I = createSelector(R, j, (t, e) => [...t, ...e].map((t2) => {
  var e2, i;
  return { name: t2.name, icon: t2.logo, url: t2.appType === x.saml ? null === (e2 = t2.samlSettings) || void 0 === e2 ? void 0 : e2.idpInitiatedUrl : null === (i = t2.oidcSettings) || void 0 === i ? void 0 : i.customIdpInitiatedLoginPageUrl };
}));
var T = createAsyncThunk("ssoApps/load", (t, { extra: { api: e } }) => e.ssoApps.load());
var W = (/* @__PURE__ */ ((t) => (...e) => (i) => {
  i.addCase(t.pending, (t2, i2) => {
    e.forEach(({ onPending: e2 }) => {
      null == e2 || e2(t2, i2);
    });
  }), i.addCase(t.fulfilled, (t2, i2) => {
    e.forEach(({ onFulfilled: e2 }) => {
      null == e2 || e2(t2, i2);
    });
  }), i.addCase(t.rejected, (t2, i2) => {
    e.forEach(({ onRejected: e2 }) => {
      null == e2 || e2(t2, i2);
    });
  });
})(T))({ onFulfilled: (t, e) => {
  var i;
  t.ssoAppsList.data = null === (i = e.payload) || void 0 === i ? void 0 : i.apps;
} }, (L = (t) => t.ssoAppsList, { onFulfilled: (t) => {
  L(t).loading = false;
}, onPending: (t) => {
  L(t).loading = true, L(t).error = null;
}, onRejected: (t, e) => {
  L(t).loading = false, L(t).error = e.error;
} }));
var L;
var C = { action: T, reducer: W };
var O = { ssoAppsList: { data: [], loading: false, error: null } };
var P = { load: "/v1/mgmt/sso/idp/apps/load" };
var U = () => __awaiter(void 0, void 0, void 0, function* () {
  return new Promise((t) => {
    t({ apps: [{ id: "ssoapp1", name: "App 1", description: "This is the first SAML app", enabled: true, appType: x.saml, logo: "logo1", samlSettings: { idpInitiatedUrl: "" } }, { id: "ssoapp2", name: "App 2", description: "This is the first OIDC app", enabled: true, appType: x.oidc, logo: "logo2" }, { id: "ssoapp3", name: "App 3", description: "This is the second SAML app", enabled: true, appType: x.saml, logo: "logo3", samlSettings: { idpInitiatedUrl: "" } }] });
  });
});
var E = ({ httpClient: t, mock: e }) => ({ load: () => __awaiter(void 0, void 0, void 0, function* () {
  if (e) return U();
  const i = yield t.get(P.load);
  return yield ((t2) => __awaiter(void 0, void 0, void 0, function* () {
    const e2 = yield t2.text(), i2 = JSON.parse(e2);
    if (!t2.ok) {
      const e3 = `${i2.errorDescription}${i2.errorMessage ? `: ${i2.errorMessage}` : ""}`;
      throw Error(e3 || `${t2.status} ${t2.statusText}`);
    }
    t2.json = () => Promise.resolve(i2), t2.text = () => Promise.resolve(e2);
  }))(i), i.json();
}) });
var $ = h((t) => {
  var i, c, u, g;
  const h2 = r(projectIdMixin, observeAttributesMixin, loggerMixin, cookieConfigMixin, baseUrlMixin)(t);
  return g = class extends h2 {
    constructor() {
      super(...arguments), i.add(this), c.set(this, void 0);
    }
    get widgetId() {
      return this.getAttribute("widget-id");
    }
    get mock() {
      return this.getAttribute("mock");
    }
    get api() {
      return __classPrivateFieldGet(this, c, "f") || __classPrivateFieldGet(this, i, "m", u).call(this), __classPrivateFieldGet(this, c, "f");
    }
    init() {
      const t2 = Object.create(null, { init: { get: () => super.init } });
      return __awaiter(this, void 0, void 0, function* () {
        var e;
        yield null === (e = t2.init) || void 0 === e ? void 0 : e.call(this), this.observeAttributes(["project-id", "base-url"], () => {
          __classPrivateFieldGet(this, c, "f") && __classPrivateFieldGet(this, i, "m", u).call(this);
        });
      });
    }
  }, c = /* @__PURE__ */ new WeakMap(), i = /* @__PURE__ */ new WeakSet(), u = function() {
    this.logger.debug("creating an sdk instance"), __classPrivateFieldSet(this, c, ((t2, e, i2) => {
      const o = Ie(Object.assign(Object.assign({}, t2), { persistTokens: true, baseHeaders: { "x-descope-widget-type": "applications-portal-widget", "x-descope-widget-id": i2, "x-descope-widget-version": "0.4.9" } }));
      return { ssoApps: E({ httpClient: o.httpClient, mock: e }) };
    })({ projectId: this.projectId, baseUrl: this.baseUrl, refreshCookieName: this.refreshCookieName }, "true" === this.mock, this.widgetId), "f");
  }, g;
});
var M = h((t) => {
  const i = r(createStateManagementMixin({ name: "widget", initialState: O, reducers: {}, extraReducers: (t2) => {
    C.reducer(t2);
  }, asyncActions: { loadSSOApps: C.action } }), initLifecycleMixin, loggerMixin, $)(t);
  return class extends i {
    constructor(...t2) {
      super(...t2), this.state = O, this.subscribe((t3) => {
        this.logger.debug("State update:", t3), this.state = t3;
      });
    }
  };
});
var N = h((t) => {
  const i = r(staticResourcesMixin, createValidateAttributesMixin({ "widget-id": createValidateAttributesMixin.missingAttrValidator }))(t);
  return class extends i {
    get widgetId() {
      return this.getAttribute("widget-id");
    }
    fetchWidgetPage(t2) {
      return __awaiter(this, void 0, void 0, function* () {
        return (yield this.fetchStaticResource(`applications-portal-widget/${this.widgetId}/${t2}`, "text")).body;
      });
    }
  };
});
var D = h((t) => {
  var n2, d, r2, l;
  return l = class extends r(loggerMixin, initLifecycleMixin, descopeUiMixin, initElementMixin, N, M)(t) {
    constructor() {
      super(...arguments), n2.add(this);
    }
    onWidgetRootReady() {
      return __awaiter(this, void 0, void 0, function* () {
      });
    }
    init() {
      const t2 = Object.create(null, { init: { get: () => super.init } });
      return __awaiter(this, void 0, void 0, function* () {
        var e;
        yield null === (e = t2.init) || void 0 === e ? void 0 : e.call(this);
        const [i] = yield Promise.all([__classPrivateFieldGet(this, n2, "m", d).call(this), this.actions.loadSSOApps()]);
        __classPrivateFieldGet(this, n2, "m", r2).call(this, i), this.onWidgetRootReady();
      });
    }
  }, n2 = /* @__PURE__ */ new WeakSet(), d = function() {
    return __awaiter(this, void 0, void 0, function* () {
      const t2 = n(yield this.fetchWidgetPage("root.html"));
      return yield this.loadDescopeUiComponents(t2), t2;
    });
  }, r2 = function(t2) {
    this.contentRootElement.append(t2.content.cloneNode(true));
  }, l;
});
var F = h((t) => {
  var i, n2, d;
  return d = class extends r(M, loggerMixin, D)(t) {
    constructor() {
      super(...arguments), i.add(this);
    }
    onWidgetRootReady() {
      const t2 = Object.create(null, { onWidgetRootReady: { get: () => super.onWidgetRootReady } });
      return __awaiter(this, void 0, void 0, function* () {
        var e;
        yield null === (e = t2.onWidgetRootReady) || void 0 === e ? void 0 : e.call(this), __classPrivateFieldGet(this, i, "m", n2).call(this, I(this.state));
      });
    }
  }, i = /* @__PURE__ */ new WeakSet(), n2 = function(t2) {
    this.appsList = new s(() => {
      var t3;
      return null === (t3 = this.shadowRoot) || void 0 === t3 ? void 0 : t3.querySelector("descope-apps-list");
    }, { logger: this.logger }), this.appsList.data = t2;
  }, d;
});
var H = h((t) => class extends r(debuggerMixin, themeMixin, F)(t) {
  init() {
    const t2 = Object.create(null, { init: { get: () => super.init } });
    return __awaiter(this, void 0, void 0, function* () {
      var e;
      yield null === (e = t2.init) || void 0 === e ? void 0 : e.call(this);
    });
  }
});
var q = r((t) => class extends H(t) {
})(HTMLElement);
customElements.define("descope-applications-portal-widget", q);
export {
  q as default
};
//# sourceMappingURL=esm-RNOSXSQL.js.map
