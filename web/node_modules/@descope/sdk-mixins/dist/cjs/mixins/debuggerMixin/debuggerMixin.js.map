{"version":3,"file":"debuggerMixin.js","sources":["../../../../src/mixins/debuggerMixin/debuggerMixin.ts"],"sourcesContent":["import { compose, createSingletonMixin } from '@descope/sdk-helpers';\nimport { initLifecycleMixin } from '../initLifecycleMixin';\nimport { LogLevel, loggerMixin } from '../loggerMixin';\nimport { DebuggerMessage } from './types';\n\nexport const debuggerMixin = createSingletonMixin(\n  <T extends CustomElementConstructor>(superclass: T) =>\n    class DebuggerMixinClass extends compose(\n      initLifecycleMixin,\n      loggerMixin,\n    )(superclass) {\n      #debuggerEle:\n        | (HTMLElement & {\n            updateData: (data: DebuggerMessage | DebuggerMessage[]) => void;\n          })\n        | null;\n\n      #disableDebugger() {\n        this.#debuggerEle?.remove();\n        this.#debuggerEle = null;\n      }\n\n      async #enableDebugger() {\n        this.#debuggerEle = document.createElement(\n          'descope-debugger',\n        ) as HTMLElement & {\n          updateData: (data: DebuggerMessage | DebuggerMessage[]) => void;\n        };\n\n        Object.assign(this.#debuggerEle.style, {\n          position: 'fixed',\n          top: '0',\n          right: '0',\n          height: '100vh',\n          width: '100vw',\n          pointerEvents: 'none',\n          zIndex: 99999,\n        });\n\n        // we are importing the debugger dynamically so we won't load it when it's not needed\n        await import('./debugger-wc');\n\n        document.body.appendChild(this.#debuggerEle);\n      }\n\n      attributeChangedCallback = (\n        attrName: string,\n        oldValue: string | null,\n        newValue: string | null,\n      ) => {\n        super.attributeChangedCallback?.(attrName, oldValue, newValue);\n\n        if (attrName === 'debug') {\n          this.#handleDebugMode();\n        }\n      };\n\n      get debug() {\n        return this.getAttribute('debug') === 'true';\n      }\n\n      #handleDebugMode() {\n        if (this.debug) this.#enableDebugger();\n        else this.#disableDebugger();\n      }\n\n      onLogEvent(logLevel: LogLevel, args: any[]) {\n        super.onLogEvent?.(logLevel, args);\n        if (logLevel === 'error') {\n          this.#updateDebuggerMessages(args[0] || 'Error', args[1]);\n        }\n      }\n\n      async init() {\n        await super.init?.();\n\n        this.#handleDebugMode();\n      }\n\n      #updateDebuggerMessages(title: string, description: string) {\n        if (title) this.#debuggerEle?.updateData({ title, description });\n      }\n    },\n);\n"],"names":["createSingletonMixin","compose","initLifecycleMixin","loggerMixin","__classPrivateFieldGet","__classPrivateFieldSet"],"mappings":"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"}