import{__awaiter as e}from"tslib";import{URL_RUN_IDS_PARAM_NAME as t,URL_TOKEN_PARAM_NAME as n,URL_CODE_PARAM_NAME as o,URL_REDIRECT_MODE_PARAM_NAME as r,URL_ERR_PARAM_NAME as i,OIDC_IDP_STATE_ID_PARAM_NAME as c,SAML_IDP_STATE_ID_PARAM_NAME as a,SAML_IDP_USERNAME_PARAM_NAME as u,DESCOPE_IDP_INITIATED_PARAM_NAME as s,SSO_APP_ID_PARAM_NAME as d,THIRD_PARTY_APP_ID_PARAM_NAME as l,THIRD_PARTY_APP_STATE_ID_PARAM_NAME as p,APPLICATION_SCOPES_PARAM_NAME as f,OIDC_LOGIN_HINT_PARAM_NAME as m,OIDC_PROMPT_PARAM_NAME as v,OIDC_ERROR_REDIRECT_URI_PARAM_NAME as h,OIDC_RESOURCE_PARAM_NAME as w,DESCOPE_ATTRIBUTE_PREFIX as g,SDK_SCRIPT_RESULTS_KEY as A,URL_REDIRECT_AUTH_CHALLENGE_PARAM_NAME as b,URL_REDIRECT_AUTH_CALLBACK_PARAM_NAME as S,URL_REDIRECT_AUTH_BACKUP_CALLBACK_PARAM_NAME as y,URL_REDIRECT_AUTH_INITIATOR_PARAM_NAME as I}from"../constants/index.js";import{EXCLUDED_STATE_KEYS as C}from"../constants/customScreens.js";import{Direction as L}from"../types.js";import{OVERRIDE_CONTENT_URL as k,BASE_CONTENT_URL as E,ASSETS_FOLDER as P}from"../constants/content.js";const U=["descope-enriched-text"];function x(e){return new URLSearchParams(window.location.search).get(e)}function T(e){if(window.history.replaceState&&x(e)){const t=new URL(window.location.href),n=new URLSearchParams(t.search);n.delete(e),t.search=n.toString(),window.history.replaceState({},"",t.toString())}}function $(t,n){return e(this,void 0,void 0,(function*(){const e=yield fetch(t,{cache:"default"});if(!e.ok)throw Error(`Error fetching URL ${t} [${e.status}]`);return{body:yield e[n](),headers:Object.fromEntries(e.headers.entries())}}))}function j({projectId:e,filename:t,assetsFolder:n=P,baseUrl:o}){const r=new URL(k||o||E);return r.pathname=((...e)=>e.join("/").replace(/\/+/g,"/"))(r.pathname,e,n,t),r.toString()}function R(e,t){if(!t)return;const n=+e,o=+t;return Number.isNaN(n)||Number.isNaN(o)?void 0:n>o?L.forward:n<o?L.backward:void 0}const O=e=>{let[n="",o=""]=(x(t)||"").split("_");const r=(e=>{var t;return(null===(t=/(.*)\|#\|.*/.exec(e))||void 0===t?void 0:t[1])||""})(n);return(!e||r&&r!==e)&&(n="",o=""),{executionId:n,stepId:o,executionFlowId:r}};function F(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function N(){T(t)}function H(){return x(n)||void 0}function B(){T(n)}function q(){return x(o)||void 0}function M(){return"popup"===x(r)}function W(){return x(i)||void 0}function _(){T(o)}function Q(){T(r)}function z(){T(i)}function D(){return{redirectAuthCodeChallenge:x(b),redirectAuthCallbackUrl:x(S),redirectAuthBackupCallbackUri:x(y),redirectAuthInitiator:x(I)}}function G(){return x(c)}function V(){T(c)}function J(){return x(a)}function K(){T(a)}function X(){return x(u)}function Y(){T(u)}function Z(){return x(s)}function ee(){T(s)}function te(){return x(d)}function ne(){return x(l)}function oe(){T(d)}function re(){T(l)}function ie(){return x(p)}function ce(){T(p)}function ae(){return x(f)}function ue(){T(f)}function se(){return x(m)}function de(){T(m)}function le(){return x(v)}function pe(){T(v)}function fe(){return x(h)}function me(){T(h)}function ve(){return x(w)}function he(){T(w)}const we=e=>e.replace(/-./g,(e=>e[1].toUpperCase())),ge=(e,t)=>n=>e[n]!==t[n],Ae=e=>Array.from((null==e?void 0:e.attributes)||[]).reduce(((e,t)=>{var n;const o=null===(n=new RegExp(`^${g}(\\S+)$`).exec(t.name))||void 0===n?void 0:n[1];return o?Object.assign(e,{[o]:t.value}):e}),{}),be=(e,t)=>{const{executionId:n,stepId:o,executionFlowId:r}=O(e);if(r&&e!==r)return t.debug("Flow id does not match the execution flow id, skipping url params handling"),{ssoQueryParams:{}};(n||o)&&N();const i=H();i&&B();const c=q();c&&_();const a=M();a&&Q();const u=W();u&&z();const{redirectAuthCodeChallenge:s,redirectAuthCallbackUrl:d,redirectAuthBackupCallbackUri:l,redirectAuthInitiator:p}=D(),f=G();f&&V();const m=J();m&&K();const v=X();m&&Y();const h=Z();h&&ee();const w=te();w&&oe();const g=ne();g&&re();const A=ie();A&&ce();const b=ae();b&&ue();const S=se();S&&de();const y=le();y&&pe();const I=fe();I&&me();const C=ve();C&&he();return{executionId:n,stepId:o,token:i,code:c,isPopup:a,exchangeError:u,redirectAuthCodeChallenge:s,redirectAuthCallbackUrl:d,redirectAuthBackupCallbackUri:l,redirectAuthInitiator:p,ssoQueryParams:{oidcIdpStateId:f,samlIdpStateId:m,samlIdpUsername:v,descopeIdpInitiated:"true"===h,ssoAppId:w,oidcLoginHint:S,oidcPrompt:y,oidcErrorRedirectUri:I,oidcResource:C,thirdPartyAppId:g,thirdPartyAppStateId:A,applicationScopes:b}}},Se=e=>{let t,n;return Object.assign(((...o)=>{return t&&(i=o,(r=t).length===i.length&&r.every(((e,t)=>e===i[t])))||(t=o,n=e(...o)),n;var r,i}),{reset:()=>{t=void 0,n=void 0}})},ye=(e,t,n)=>{if(!0===t||"skipFirstScreen"===t&&!n){const t=e.querySelector("*[name]");setTimeout((()=>{null==t||t.focus()}))}},Ie=e=>{e.querySelectorAll("*[name]").forEach((t=>{t.addEventListener("blur",(()=>{var n;const o=()=>{var e;const n=t.focus;t.focus=()=>{},null===(e=t.reportValidity)||void 0===e||e.call(t),setTimeout((()=>{t.focus=n}))};if("true"===t.getAttribute("invalid")||(null===(n=t.value)||void 0===n?void 0:n.length))return void o();const r={timer:void 0},i=e=>{"true"===e.target.getAttribute("formnovalidate")&&(clearTimeout(r.timer),r.timer=void 0)};r.timer=setTimeout((()=>{e.removeEventListener("click",i),o(),r.timer=void 0}),150),e.addEventListener("click",i,{once:!0})}))}))};function Ce(e,t,n){return new Promise(((o,r)=>{let i=!1;const c=setTimeout((()=>{i=!0,void 0!==n?o(n):r(new Error(`Promise timed out after ${e} ms`))}),e);t.then((e=>{i||(clearTimeout(c),o(e))})).catch((e=>{i||(clearTimeout(c),r(e))}))}))}const Le=()=>{var e;const t=null===(e=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===e?void 0:e.brands,n=null==t?void 0:t.find((({brand:e,version:t})=>"Chromium"===e&&parseFloat(t)));return n?n.version:0},ke=(e,{oidcIdpStateId:t,samlIdpStateId:n,samlIdpUsername:o,ssoAppId:r,oidcLoginHint:i,oidcPrompt:c,oidcErrorRedirectUri:a,oidcResource:u,thirdPartyAppId:s,thirdPartyAppStateId:d,applicationScopes:l})=>!(!e||t||n||o||r||i||c||a||u||s||d||l),Ee=(e,t,n,o)=>{const r=document.createElement("form");r.method="POST",r.action=e,r.innerHTML=`\n  <input type="hidden" role="saml-response" name="SAMLResponse" value="${t}" />\n  <input type="hidden" role="saml-relay-state" name="RelayState" value="${n}" />\n  <input style="display: none;" id="SAMLSubmitButton" type="submit" value="Continue" />\n  `,document.body.appendChild(r),o(r)},Pe=e=>null==e?void 0:e.submit(),Ue=(e,t)=>{const n=t.find((t=>e[t]));return n?e[n]:null},xe=(e,t=100)=>{let n;return function(...o){n||e.apply(this,o),clearTimeout(n),n=setTimeout((()=>{n=null}),t)}};function Te(e){if(e)return{locale:e.toLowerCase(),fallback:e.toLowerCase()};const t=navigator.language;return t?t.includes("-")?{locale:t.toLowerCase(),fallback:t.split("-")[0].toLowerCase()}:{locale:t.toLowerCase(),fallback:t.toLowerCase()}:{locale:"",fallback:""}}const $e=()=>{document.querySelectorAll('[data-hidden-input="true"]').forEach((e=>e.remove()))},je=e=>U.includes(e),Re=e=>{var t,n,o;const r=(i=e.screenState,c=(e,t)=>C.includes(t)||t.startsWith("_"),Object.fromEntries(Object.entries(i).filter((([e,t])=>!c(t,e)))));var i,c;const{screenState:{errorText:a,errorType:u}}=e;return(a||u)&&(r.error={text:a,type:u}),e.action&&(r.action=e.action),(null===(o=null===(n=null===(t=e.screenState)||void 0===t?void 0:t.componentsConfig)||void 0===n?void 0:n.thirdPartyAppApproveScopes)||void 0===o?void 0:o.data)&&(r.inboundAppApproveScopes=e.screenState.componentsConfig.thirdPartyAppApproveScopes.data),r},Oe=e=>{const t=Object.assign({},e);return e.inboundAppApproveScopes&&(t.thirdPartyAppApproveScopes=e.inboundAppApproveScopes),t};function Fe(e,t){return`${A}.${t?`${e}_${t}`:e}`}const Ne=(e,t,n,o)=>{const r=void 0!==window.screenLeft?window.screenLeft:window.screen.left,i=void 0!==window.screenTop?window.screenTop:window.screen.top,c=((window.innerWidth||document.documentElement.clientWidth||window.screen.width)-n)/2+r,a=((window.innerHeight||document.documentElement.clientHeight||window.screen.height)-o)/2+i,u=window.open(e,t,`width=${n},height=${o},top=${a},left=${c},scrollbars=yes,resizable=yes`);return u.focus(),u};export{we as camelCase,ue as clearApplicationScopesParamFromUrl,_ as clearCodeFromUrl,ee as clearDescopeIDPInitiatedParamFromUrl,z as clearExchangeErrorFromUrl,Q as clearIsPopupFromUrl,me as clearOIDCErrorRedirectUriParamFromUrl,V as clearOIDCIDPParamFromUrl,de as clearOIDCLoginHintParamFromUrl,pe as clearOIDCPromptParamFromUrl,he as clearOIDCResourceParamFromUrl,$e as clearPreviousExternalInputs,N as clearRunIdsFromUrl,K as clearSAMLIDPParamFromUrl,Y as clearSAMLIDPUsernameParamFromUrl,oe as clearSSOAppIdParamFromUrl,re as clearThirdPartyAppIdParamFromUrl,ce as clearThirdPartyAppStateIdParamFromUrl,B as clearTokenFromUrl,ge as createIsChanged,$ as fetchContent,R as getAnimationDirection,ae as getApplicationScopesParamFromUrl,Le as getChromiumVersion,q as getCodeFromUrl,j as getContentUrl,Z as getDescopeIDPInitiatedParamFromUrl,Ae as getElementDescopeAttributes,W as getExchangeErrorFromUrl,Ue as getFirstNonEmptyValue,M as getIsPopupFromUrl,fe as getOIDCErrorRedirectUriParamFromUrl,G as getOIDCIDPParamFromUrl,se as getOIDCLoginHintParamFromUrl,le as getOIDCPromptParamFromUrl,ve as getOIDCResourceParamFromUrl,D as getRedirectAuthFromUrl,O as getRunIdsFromUrl,J as getSAMLIDPParamFromUrl,X as getSAMLIDPUsernameParamFromUrl,te as getSSOAppIdParamFromUrl,Fe as getScriptResultPath,ne as getThirdPartyAppIdParamFromUrl,ie as getThirdPartyAppStateIdParamFromUrl,H as getTokenFromUrl,Te as getUserLocale,ye as handleAutoFocus,Ie as handleReportValidityOnBlur,be as handleUrlParams,Ee as injectSamlIdpForm,F as isChromium,xe as leadingDebounce,Ne as openCenteredPopup,je as shouldHandleMarkdown,ke as showFirstScreenOnExecutionInit,Pe as submitForm,Ce as timeoutPromise,Oe as transformScreenInputs,Re as transformStepStateForCustomScreen,Se as withMemCache};
//# sourceMappingURL=helpers.js.map
