
      /**
       * @descope/applications-portal-widget v0.4.9
       */
      import{createSingletonMixin as t,compose as e,createTemplate as i}from"@descope/sdk-helpers";import{__awaiter as o,__classPrivateFieldGet as s,__classPrivateFieldSet as n}from"tslib";import{projectIdMixin as d,observeAttributesMixin as r,loggerMixin as a,cookieConfigMixin as l,baseUrlMixin as p,createStateManagementMixin as c,initLifecycleMixin as u,staticResourcesMixin as g,createValidateAttributesMixin as h,descopeUiMixin as v,initElementMixin as m,debuggerMixin as f,themeMixin as y}from"@descope/sdk-mixins";import{AppsListDriver as b}from"@descope/sdk-component-drivers";import{createSelector as w}from"reselect";import{createAsyncThunk as A}from"@reduxjs/toolkit";import k from"@descope/web-js-sdk";var x;!function(t){t.oidc="oidc",t.saml="saml"}(x||(x={}));const S=t=>t.ssoAppsList.data,R=w(S,(t=>{var e;return null===(e=null==t?void 0:t.filter)||void 0===e?void 0:e.call(t,(t=>t.appType===x.saml))})),j=w(S,(t=>{var e;return null===(e=null==t?void 0:t.filter)||void 0===e?void 0:e.call(t,(t=>{var e;return t.appType===x.oidc&&(null===(e=t.oidcSettings)||void 0===e?void 0:e.customIdpInitiatedLoginPageUrl)}))})),I=w(R,j,((t,e)=>[...t,...e].map((t=>{var e,i;return{name:t.name,icon:t.logo,url:t.appType===x.saml?null===(e=t.samlSettings)||void 0===e?void 0:e.idpInitiatedUrl:null===(i=t.oidcSettings)||void 0===i?void 0:i.customIdpInitiatedLoginPageUrl}})))),T=A("ssoApps/load",((t,{extra:{api:e}})=>e.ssoApps.load())),W=(t=>(...e)=>i=>{i.addCase(t.pending,((t,i)=>{e.forEach((({onPending:e})=>{null==e||e(t,i)}))})),i.addCase(t.fulfilled,((t,i)=>{e.forEach((({onFulfilled:e})=>{null==e||e(t,i)}))})),i.addCase(t.rejected,((t,i)=>{e.forEach((({onRejected:e})=>{null==e||e(t,i)}))}))})(T)({onFulfilled:(t,e)=>{var i;t.ssoAppsList.data=null===(i=e.payload)||void 0===i?void 0:i.apps}},(L=t=>t.ssoAppsList,{onFulfilled:t=>{L(t).loading=!1},onPending:t=>{L(t).loading=!0,L(t).error=null},onRejected:(t,e)=>{L(t).loading=!1,L(t).error=e.error}}));var L;const C={action:T,reducer:W},O={ssoAppsList:{data:[],loading:!1,error:null}},P={load:"/v1/mgmt/sso/idp/apps/load"},U=()=>o(void 0,void 0,void 0,(function*(){return new Promise((t=>{t({apps:[{id:"ssoapp1",name:"App 1",description:"This is the first SAML app",enabled:!0,appType:x.saml,logo:"logo1",samlSettings:{idpInitiatedUrl:""}},{id:"ssoapp2",name:"App 2",description:"This is the first OIDC app",enabled:!0,appType:x.oidc,logo:"logo2"},{id:"ssoapp3",name:"App 3",description:"This is the second SAML app",enabled:!0,appType:x.saml,logo:"logo3",samlSettings:{idpInitiatedUrl:""}}]})}))})),E=({httpClient:t,mock:e})=>({load:()=>o(void 0,void 0,void 0,(function*(){if(e)return U();const i=yield t.get(P.load);return yield(t=>o(void 0,void 0,void 0,(function*(){const e=yield t.text(),i=JSON.parse(e);if(!t.ok){const e=`${i.errorDescription}${i.errorMessage?`: ${i.errorMessage}`:""}`;throw Error(e||`${t.status} ${t.statusText}`)}t.json=()=>Promise.resolve(i),t.text=()=>Promise.resolve(e)})))(i),i.json()}))}),$=t((t=>{var i,c,u,g;const h=e(d,r,a,l,p)(t);return g=class extends h{constructor(){super(...arguments),i.add(this),c.set(this,void 0)}get widgetId(){return this.getAttribute("widget-id")}get mock(){return this.getAttribute("mock")}get api(){return s(this,c,"f")||s(this,i,"m",u).call(this),s(this,c,"f")}init(){const t=Object.create(null,{init:{get:()=>super.init}});return o(this,void 0,void 0,(function*(){var e;yield null===(e=t.init)||void 0===e?void 0:e.call(this),this.observeAttributes(["project-id","base-url"],(()=>{s(this,c,"f")&&s(this,i,"m",u).call(this)}))}))}},c=new WeakMap,i=new WeakSet,u=function(){this.logger.debug("creating an sdk instance"),n(this,c,((t,e,i)=>{const o=k(Object.assign(Object.assign({},t),{persistTokens:!0,baseHeaders:{"x-descope-widget-type":"applications-portal-widget","x-descope-widget-id":i,"x-descope-widget-version":"0.4.9"}}));return{ssoApps:E({httpClient:o.httpClient,mock:e})}})({projectId:this.projectId,baseUrl:this.baseUrl,refreshCookieName:this.refreshCookieName},"true"===this.mock,this.widgetId),"f")},g})),M=t((t=>{const i=e(c({name:"widget",initialState:O,reducers:{},extraReducers:t=>{C.reducer(t)},asyncActions:{loadSSOApps:C.action}}),u,a,$)(t);return class extends i{constructor(...t){super(...t),this.state=O,this.subscribe((t=>{this.logger.debug("State update:",t),this.state=t}))}}})),N=t((t=>{const i=e(g,h({"widget-id":h.missingAttrValidator}))(t);return class extends i{get widgetId(){return this.getAttribute("widget-id")}fetchWidgetPage(t){return o(this,void 0,void 0,(function*(){return(yield this.fetchStaticResource(`applications-portal-widget/${this.widgetId}/${t}`,"text")).body}))}}})),D=t((t=>{var n,d,r,l;return l=class extends(e(a,u,v,m,N,M)(t)){constructor(){super(...arguments),n.add(this)}onWidgetRootReady(){return o(this,void 0,void 0,(function*(){}))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return o(this,void 0,void 0,(function*(){var e;yield null===(e=t.init)||void 0===e?void 0:e.call(this);const[i]=yield Promise.all([s(this,n,"m",d).call(this),this.actions.loadSSOApps()]);s(this,n,"m",r).call(this,i),this.onWidgetRootReady()}))}},n=new WeakSet,d=function(){return o(this,void 0,void 0,(function*(){const t=i(yield this.fetchWidgetPage("root.html"));return yield this.loadDescopeUiComponents(t),t}))},r=function(t){this.contentRootElement.append(t.content.cloneNode(!0))},l})),F=t((t=>{var i,n,d;return d=class extends(e(M,a,D)(t)){constructor(){super(...arguments),i.add(this)}onWidgetRootReady(){const t=Object.create(null,{onWidgetRootReady:{get:()=>super.onWidgetRootReady}});return o(this,void 0,void 0,(function*(){var e;yield null===(e=t.onWidgetRootReady)||void 0===e?void 0:e.call(this),s(this,i,"m",n).call(this,I(this.state))}))}},i=new WeakSet,n=function(t){this.appsList=new b((()=>{var t;return null===(t=this.shadowRoot)||void 0===t?void 0:t.querySelector("descope-apps-list")}),{logger:this.logger}),this.appsList.data=t},d})),H=t((t=>class extends(e(f,y,F)(t)){init(){const t=Object.create(null,{init:{get:()=>super.init}});return o(this,void 0,void 0,(function*(){var e;yield null===(e=t.init)||void 0===e?void 0:e.call(this)}))}})),q=e((t=>class extends(H(t)){}))(HTMLElement);customElements.define("descope-applications-portal-widget",q);export{q as default};
//# sourceMappingURL=index.js.map
