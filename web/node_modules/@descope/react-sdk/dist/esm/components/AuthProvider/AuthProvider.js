import e,{useState as t,useRef as s,useEffect as r,useCallback as o,useMemo as n}from"react";import i from"../../hooks/Context.js";import{withValidation as a}from"../../utils.js";import c from"./useSdk.js";const u=({projectId:u,baseUrl:d="",baseStaticUrl:h="",baseCdnUrl:f="",sessionTokenViaCookie:k=!1,persistTokens:l=!0,autoRefresh:U=!0,oidcConfig:g,storeLastAuthenticatedUser:m=!0,keepLastAuthenticatedUserAfterLogout:p=!1,refreshCookieName:C="",getExternalToken:L,children:A})=>{const[S,b]=t(),[T,j]=t(),[I,v]=t(!1),[x,N]=t(!1),[E,F]=t(!1),[R,V]=t(!!g),y=s(!1),O=c({projectId:u,baseUrl:d,persistTokens:l,autoRefresh:U,sessionTokenViaCookie:k,oidcConfig:g,storeLastAuthenticatedUser:m,keepLastAuthenticatedUserAfterLogout:p,refreshCookieName:C,getExternalToken:L});r((()=>{if(O){const e=O.onSessionTokenChange(j),t=O.onUserChange(b),s=O.onIsAuthenticatedChange(v);return()=>{e(),t(),s()}}}),[O]);const P=s(!1),q=s(!1);r((()=>{O&&g&&!y.current&&(y.current=!0,O.oidc.finishLoginIfNeed().finally((()=>{V(!1),P.current=!0})))}),[]);const w=o((()=>{P.current||(P.current=!0,F(!0),a(null==O?void 0:O.refresh)(void 0,!0).then((()=>{F(!1)})))}),[O]),z=o((()=>{q.current||(q.current=!0,N(!0),a(O.me)().then((()=>{N(!1)})))}),[O]),B=n((()=>({fetchUser:z,user:S,isUserLoading:x,isUserFetched:q.current,fetchSession:w,session:T,isAuthenticated:I,isSessionLoading:E,isOidcLoading:R,isSessionFetched:P.current,projectId:u,baseUrl:d,baseStaticUrl:h,baseCdnUrl:f,storeLastAuthenticatedUser:m,keepLastAuthenticatedUserAfterLogout:p,refreshCookieName:C,setUser:b,setSession:j,setIsAuthenticated:v,sdk:O})),[z,S,x,q.current,w,T,I,E,R,P.current,u,d,h,f,p,C,b,j,v,O]);return e.createElement(i.Provider,{value:B},A)};export{u as default};
//# sourceMappingURL=AuthProvider.js.map
