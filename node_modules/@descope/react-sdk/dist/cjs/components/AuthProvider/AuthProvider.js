"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("../../hooks/Context.js"),s=require("../../utils.js"),r=require("./useSdk.js");function n(e){return e&&e.__esModule?e:{default:e}}var o=n(e);exports.default=({projectId:n,baseUrl:i="",baseStaticUrl:a="",baseCdnUrl:u="",sessionTokenViaCookie:c=!1,persistTokens:d=!0,autoRefresh:f=!0,oidcConfig:l,storeLastAuthenticatedUser:h=!0,keepLastAuthenticatedUserAfterLogout:k=!1,refreshCookieName:U="",getExternalToken:C,children:g})=>{const[S,L]=e.useState(),[A,p]=e.useState(),[b,j]=e.useState(!1),[v,T]=e.useState(!1),[m,I]=e.useState(!1),[x,E]=e.useState(!!l),R=e.useRef(!1),q=r.default({projectId:n,baseUrl:i,persistTokens:d,autoRefresh:f,sessionTokenViaCookie:c,oidcConfig:l,storeLastAuthenticatedUser:h,keepLastAuthenticatedUserAfterLogout:k,refreshCookieName:U,getExternalToken:C});e.useEffect((()=>{if(q){const e=q.onSessionTokenChange(p),t=q.onUserChange(L),s=q.onIsAuthenticatedChange(j);return()=>{e(),t(),s()}}}),[q]);const N=e.useRef(!1),V=e.useRef(!1);e.useEffect((()=>{q&&l&&!R.current&&(R.current=!0,q.oidc.finishLoginIfNeed().finally((()=>{E(!1),N.current=!0})))}),[]);const _=e.useCallback((()=>{N.current||(N.current=!0,I(!0),s.withValidation(null==q?void 0:q.refresh)(void 0,!0).then((()=>{I(!1)})))}),[q]),M=e.useCallback((()=>{V.current||(V.current=!0,T(!0),s.withValidation(q.me)().then((()=>{T(!1)})))}),[q]),w=e.useMemo((()=>({fetchUser:M,user:S,isUserLoading:v,isUserFetched:V.current,fetchSession:_,session:A,isAuthenticated:b,isSessionLoading:m,isOidcLoading:x,isSessionFetched:N.current,projectId:n,baseUrl:i,baseStaticUrl:a,baseCdnUrl:u,storeLastAuthenticatedUser:h,keepLastAuthenticatedUserAfterLogout:k,refreshCookieName:U,setUser:L,setSession:p,setIsAuthenticated:j,sdk:q})),[M,S,v,V.current,_,A,b,m,x,N.current,n,i,a,u,k,U,L,p,j,q]);return o.default.createElement(t.default.Provider,{value:w},g)};
//# sourceMappingURL=AuthProvider.js.map
