"use strict";var e=require("tslib"),r=require("../constants/index.js"),t=require("../constants/customScreens.js"),o=require("../types.js"),n=require("../constants/content.js");const i=["descope-enriched-text"];function a(e){return new URLSearchParams(window.location.search).get(e)}function c(e){if(window.history.replaceState&&a(e)){const r=new URL(window.location.href),t=new URLSearchParams(r.search);t.delete(e),r.search=t.toString(),window.history.replaceState({},"",r.toString())}}const s=e=>{let[t="",o=""]=(a(r.URL_RUN_IDS_PARAM_NAME)||"").split("_");const n=(e=>{var r;return(null===(r=/(.*)\|#\|.*/.exec(e))||void 0===r?void 0:r[1])||""})(t);return(!e||n&&n!==e)&&(t="",o=""),{executionId:t,stepId:o,executionFlowId:n}};function l(){c(r.URL_RUN_IDS_PARAM_NAME)}function u(){return a(r.URL_TOKEN_PARAM_NAME)||void 0}function A(){c(r.URL_TOKEN_PARAM_NAME)}function p(){return a(r.URL_CODE_PARAM_NAME)||void 0}function d(){return"popup"===a(r.URL_REDIRECT_MODE_PARAM_NAME)}function _(){return a(r.URL_ERR_PARAM_NAME)||void 0}function m(){c(r.URL_CODE_PARAM_NAME)}function P(){c(r.URL_REDIRECT_MODE_PARAM_NAME)}function E(){c(r.URL_ERR_PARAM_NAME)}function I(){return{redirectAuthCodeChallenge:a(r.URL_REDIRECT_AUTH_CHALLENGE_PARAM_NAME),redirectAuthCallbackUrl:a(r.URL_REDIRECT_AUTH_CALLBACK_PARAM_NAME),redirectAuthBackupCallbackUri:a(r.URL_REDIRECT_AUTH_BACKUP_CALLBACK_PARAM_NAME),redirectAuthInitiator:a(r.URL_REDIRECT_AUTH_INITIATOR_PARAM_NAME)}}function R(){return a(r.OIDC_IDP_STATE_ID_PARAM_NAME)}function M(){c(r.OIDC_IDP_STATE_ID_PARAM_NAME)}function S(){return a(r.SAML_IDP_STATE_ID_PARAM_NAME)}function U(){c(r.SAML_IDP_STATE_ID_PARAM_NAME)}function h(){return a(r.SAML_IDP_USERNAME_PARAM_NAME)}function f(){c(r.SAML_IDP_USERNAME_PARAM_NAME)}function C(){return a(r.DESCOPE_IDP_INITIATED_PARAM_NAME)}function D(){c(r.DESCOPE_IDP_INITIATED_PARAM_NAME)}function T(){return a(r.SSO_APP_ID_PARAM_NAME)}function x(){return a(r.THIRD_PARTY_APP_ID_PARAM_NAME)}function g(){c(r.SSO_APP_ID_PARAM_NAME)}function v(){c(r.THIRD_PARTY_APP_ID_PARAM_NAME)}function N(){return a(r.THIRD_PARTY_APP_STATE_ID_PARAM_NAME)}function L(){c(r.THIRD_PARTY_APP_STATE_ID_PARAM_NAME)}function O(){return a(r.APPLICATION_SCOPES_PARAM_NAME)}function w(){c(r.APPLICATION_SCOPES_PARAM_NAME)}function F(){return a(r.OIDC_LOGIN_HINT_PARAM_NAME)}function b(){c(r.OIDC_LOGIN_HINT_PARAM_NAME)}function y(){return a(r.OIDC_PROMPT_PARAM_NAME)}function k(){c(r.OIDC_PROMPT_PARAM_NAME)}function H(){return a(r.OIDC_ERROR_REDIRECT_URI_PARAM_NAME)}function $(){c(r.OIDC_ERROR_REDIRECT_URI_PARAM_NAME)}function j(){return a(r.OIDC_RESOURCE_PARAM_NAME)}function B(){c(r.OIDC_RESOURCE_PARAM_NAME)}exports.camelCase=e=>e.replace(/-./g,(e=>e[1].toUpperCase())),exports.clearApplicationScopesParamFromUrl=w,exports.clearCodeFromUrl=m,exports.clearDescopeIDPInitiatedParamFromUrl=D,exports.clearExchangeErrorFromUrl=E,exports.clearIsPopupFromUrl=P,exports.clearOIDCErrorRedirectUriParamFromUrl=$,exports.clearOIDCIDPParamFromUrl=M,exports.clearOIDCLoginHintParamFromUrl=b,exports.clearOIDCPromptParamFromUrl=k,exports.clearOIDCResourceParamFromUrl=B,exports.clearPreviousExternalInputs=()=>{document.querySelectorAll('[data-hidden-input="true"]').forEach((e=>e.remove()))},exports.clearRunIdsFromUrl=l,exports.clearSAMLIDPParamFromUrl=U,exports.clearSAMLIDPUsernameParamFromUrl=f,exports.clearSSOAppIdParamFromUrl=g,exports.clearThirdPartyAppIdParamFromUrl=v,exports.clearThirdPartyAppStateIdParamFromUrl=L,exports.clearTokenFromUrl=A,exports.createIsChanged=(e,r)=>t=>e[t]!==r[t],exports.fetchContent=function(r,t){return e.__awaiter(this,void 0,void 0,(function*(){const e=yield fetch(r,{cache:"default"});if(!e.ok)throw Error(`Error fetching URL ${r} [${e.status}]`);return{body:yield e[t](),headers:Object.fromEntries(e.headers.entries())}}))},exports.getAnimationDirection=function(e,r){if(!r)return;const t=+e,n=+r;return Number.isNaN(t)||Number.isNaN(n)?void 0:t>n?o.Direction.forward:t<n?o.Direction.backward:void 0},exports.getApplicationScopesParamFromUrl=O,exports.getChromiumVersion=()=>{var e;const r=null===(e=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===e?void 0:e.brands,t=null==r?void 0:r.find((({brand:e,version:r})=>"Chromium"===e&&parseFloat(r)));return t?t.version:0},exports.getCodeFromUrl=p,exports.getContentUrl=function({projectId:e,filename:r,assetsFolder:t=n.ASSETS_FOLDER,baseUrl:o}){const i=new URL(n.OVERRIDE_CONTENT_URL||o||n.BASE_CONTENT_URL);return i.pathname=((...e)=>e.join("/").replace(/\/+/g,"/"))(i.pathname,e,t,r),i.toString()},exports.getDescopeIDPInitiatedParamFromUrl=C,exports.getElementDescopeAttributes=e=>Array.from((null==e?void 0:e.attributes)||[]).reduce(((e,t)=>{var o;const n=null===(o=new RegExp(`^${r.DESCOPE_ATTRIBUTE_PREFIX}(\\S+)$`).exec(t.name))||void 0===o?void 0:o[1];return n?Object.assign(e,{[n]:t.value}):e}),{}),exports.getExchangeErrorFromUrl=_,exports.getFirstNonEmptyValue=(e,r)=>{const t=r.find((r=>e[r]));return t?e[t]:null},exports.getIsPopupFromUrl=d,exports.getOIDCErrorRedirectUriParamFromUrl=H,exports.getOIDCIDPParamFromUrl=R,exports.getOIDCLoginHintParamFromUrl=F,exports.getOIDCPromptParamFromUrl=y,exports.getOIDCResourceParamFromUrl=j,exports.getRedirectAuthFromUrl=I,exports.getRunIdsFromUrl=s,exports.getSAMLIDPParamFromUrl=S,exports.getSAMLIDPUsernameParamFromUrl=h,exports.getSSOAppIdParamFromUrl=T,exports.getScriptResultPath=function(e,t){const o=t?`${e}_${t}`:e;return`${r.SDK_SCRIPT_RESULTS_KEY}.${o}`},exports.getThirdPartyAppIdParamFromUrl=x,exports.getThirdPartyAppStateIdParamFromUrl=N,exports.getTokenFromUrl=u,exports.getUserLocale=function(e){if(e)return{locale:e.toLowerCase(),fallback:e.toLowerCase()};const r=navigator.language;return r?r.includes("-")?{locale:r.toLowerCase(),fallback:r.split("-")[0].toLowerCase()}:{locale:r.toLowerCase(),fallback:r.toLowerCase()}:{locale:"",fallback:""}},exports.handleAutoFocus=(e,r,t)=>{if(!0===r||"skipFirstScreen"===r&&!t){const r=e.querySelector("*[name]");setTimeout((()=>{null==r||r.focus()}))}},exports.handleReportValidityOnBlur=e=>{e.querySelectorAll("*[name]").forEach((r=>{r.addEventListener("blur",(()=>{var t;const o=()=>{var e;const t=r.focus;r.focus=()=>{},null===(e=r.reportValidity)||void 0===e||e.call(r),setTimeout((()=>{r.focus=t}))};if("true"===r.getAttribute("invalid")||(null===(t=r.value)||void 0===t?void 0:t.length))return void o();const n={timer:void 0},i=e=>{"true"===e.target.getAttribute("formnovalidate")&&(clearTimeout(n.timer),n.timer=void 0)};n.timer=setTimeout((()=>{e.removeEventListener("click",i),o(),n.timer=void 0}),150),e.addEventListener("click",i,{once:!0})}))}))},exports.handleUrlParams=(e,r)=>{const{executionId:t,stepId:o,executionFlowId:n}=s(e);if(n&&e!==n)return r.debug("Flow id does not match the execution flow id, skipping url params handling"),{ssoQueryParams:{}};(t||o)&&l();const i=u();i&&A();const a=p();a&&m();const c=d();c&&P();const q=_();q&&E();const{redirectAuthCodeChallenge:K,redirectAuthCallbackUrl:Y,redirectAuthBackupCallbackUri:V,redirectAuthInitiator:G}=I(),W=R();W&&M();const Q=S();Q&&U();const X=h();Q&&f();const z=C();z&&D();const J=T();J&&g();const Z=x();Z&&v();const ee=N();ee&&L();const re=O();re&&w();const te=F();te&&b();const oe=y();oe&&k();const ne=H();ne&&$();const ie=j();ie&&B();return{executionId:t,stepId:o,token:i,code:a,isPopup:c,exchangeError:q,redirectAuthCodeChallenge:K,redirectAuthCallbackUrl:Y,redirectAuthBackupCallbackUri:V,redirectAuthInitiator:G,ssoQueryParams:{oidcIdpStateId:W,samlIdpStateId:Q,samlIdpUsername:X,descopeIdpInitiated:"true"===z,ssoAppId:J,oidcLoginHint:te,oidcPrompt:oe,oidcErrorRedirectUri:ne,oidcResource:ie,thirdPartyAppId:Z,thirdPartyAppStateId:ee,applicationScopes:re}}},exports.injectSamlIdpForm=(e,r,t,o)=>{const n=document.createElement("form");n.method="POST",n.action=e,n.innerHTML=`\n  <input type="hidden" role="saml-response" name="SAMLResponse" value="${r}" />\n  <input type="hidden" role="saml-relay-state" name="RelayState" value="${t}" />\n  <input style="display: none;" id="SAMLSubmitButton" type="submit" value="Continue" />\n  `,document.body.appendChild(n),o(n)},exports.isChromium=function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},exports.leadingDebounce=(e,r=100)=>{let t;return function(...o){t||e.apply(this,o),clearTimeout(t),t=setTimeout((()=>{t=null}),r)}},exports.openCenteredPopup=(e,r,t,o)=>{const n=void 0!==window.screenLeft?window.screenLeft:window.screen.left,i=void 0!==window.screenTop?window.screenTop:window.screen.top,a=((window.innerWidth||document.documentElement.clientWidth||window.screen.width)-t)/2+n,c=((window.innerHeight||document.documentElement.clientHeight||window.screen.height)-o)/2+i,s=window.open(e,r,`width=${t},height=${o},top=${c},left=${a},scrollbars=yes,resizable=yes`);return s.focus(),s},exports.shouldHandleMarkdown=e=>i.includes(e),exports.showFirstScreenOnExecutionInit=(e,{oidcIdpStateId:r,samlIdpStateId:t,samlIdpUsername:o,ssoAppId:n,oidcLoginHint:i,oidcPrompt:a,oidcErrorRedirectUri:c,oidcResource:s,thirdPartyAppId:l,thirdPartyAppStateId:u,applicationScopes:A})=>!(!e||r||t||o||n||i||a||c||s||l||u||A),exports.submitForm=e=>null==e?void 0:e.submit(),exports.timeoutPromise=function(e,r,t){return new Promise(((o,n)=>{let i=!1;const a=setTimeout((()=>{i=!0,void 0!==t?o(t):n(new Error(`Promise timed out after ${e} ms`))}),e);r.then((e=>{i||(clearTimeout(a),o(e))})).catch((e=>{i||(clearTimeout(a),n(e))}))}))},exports.transformScreenInputs=e=>{const r=Object.assign({},e);return e.inboundAppApproveScopes&&(r.thirdPartyAppApproveScopes=e.inboundAppApproveScopes),r},exports.transformStepStateForCustomScreen=e=>{var r,o,n;const i=(a=e.screenState,c=(e,r)=>t.EXCLUDED_STATE_KEYS.includes(r)||r.startsWith("_"),Object.fromEntries(Object.entries(a).filter((([e,r])=>!c(r,e)))));var a,c;const{screenState:{errorText:s,errorType:l}}=e;return(s||l)&&(i.error={text:s,type:l}),e.action&&(i.action=e.action),(null===(n=null===(o=null===(r=e.screenState)||void 0===r?void 0:r.componentsConfig)||void 0===o?void 0:o.thirdPartyAppApproveScopes)||void 0===n?void 0:n.data)&&(i.inboundAppApproveScopes=e.screenState.componentsConfig.thirdPartyAppApproveScopes.data),i},exports.withMemCache=e=>{let r,t;return Object.assign(((...o)=>{return r&&(i=o,(n=r).length===i.length&&n.every(((e,r)=>e===i[r])))||(r=o,t=e(...o)),t;var n,i}),{reset:()=>{r=void 0,t=void 0}})};
//# sourceMappingURL=helpers.js.map
